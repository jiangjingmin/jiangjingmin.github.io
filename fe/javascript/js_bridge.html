<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JSBridge | 前端档案</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="前端通关宝典">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.67a062f1.css" as="style"><link rel="preload" href="/assets/js/app.7dfc15e8.js" as="script"><link rel="preload" href="/assets/js/2.db7a59af.js" as="script"><link rel="preload" href="/assets/js/132.fee282f7.js" as="script"><link rel="prefetch" href="/assets/js/10.3bbe2f24.js"><link rel="prefetch" href="/assets/js/100.94ebf6c4.js"><link rel="prefetch" href="/assets/js/101.eb1f0a7f.js"><link rel="prefetch" href="/assets/js/102.3f4f14f0.js"><link rel="prefetch" href="/assets/js/103.5ed45f48.js"><link rel="prefetch" href="/assets/js/104.29ef9283.js"><link rel="prefetch" href="/assets/js/105.e4051d70.js"><link rel="prefetch" href="/assets/js/106.ec073f00.js"><link rel="prefetch" href="/assets/js/107.9b165150.js"><link rel="prefetch" href="/assets/js/108.84996806.js"><link rel="prefetch" href="/assets/js/109.67f72c05.js"><link rel="prefetch" href="/assets/js/11.f5dcfed9.js"><link rel="prefetch" href="/assets/js/110.edc92528.js"><link rel="prefetch" href="/assets/js/111.4599bdae.js"><link rel="prefetch" href="/assets/js/112.70ead8d5.js"><link rel="prefetch" href="/assets/js/113.f0801886.js"><link rel="prefetch" href="/assets/js/114.25ab8fa4.js"><link rel="prefetch" href="/assets/js/115.36fc62f3.js"><link rel="prefetch" href="/assets/js/116.8df9a6aa.js"><link rel="prefetch" href="/assets/js/117.1ec0fada.js"><link rel="prefetch" href="/assets/js/118.51c54869.js"><link rel="prefetch" href="/assets/js/119.d708669d.js"><link rel="prefetch" href="/assets/js/12.eba9a66a.js"><link rel="prefetch" href="/assets/js/120.a44efeea.js"><link rel="prefetch" href="/assets/js/121.e6bec547.js"><link rel="prefetch" href="/assets/js/122.e54e19e1.js"><link rel="prefetch" href="/assets/js/123.62aa41d0.js"><link rel="prefetch" href="/assets/js/124.956d6df7.js"><link rel="prefetch" href="/assets/js/125.1769166b.js"><link rel="prefetch" href="/assets/js/126.8b16d246.js"><link rel="prefetch" href="/assets/js/127.fc7608d6.js"><link rel="prefetch" href="/assets/js/128.261529c8.js"><link rel="prefetch" href="/assets/js/129.77241cfd.js"><link rel="prefetch" href="/assets/js/13.afade12a.js"><link rel="prefetch" href="/assets/js/130.de2ab6e4.js"><link rel="prefetch" href="/assets/js/131.bad9644b.js"><link rel="prefetch" href="/assets/js/133.6eaf81a7.js"><link rel="prefetch" href="/assets/js/134.9a50bdc7.js"><link rel="prefetch" href="/assets/js/135.b91963f4.js"><link rel="prefetch" href="/assets/js/136.114cbcde.js"><link rel="prefetch" href="/assets/js/137.cb66a2a4.js"><link rel="prefetch" href="/assets/js/138.1d3a1791.js"><link rel="prefetch" href="/assets/js/139.597a9ba5.js"><link rel="prefetch" href="/assets/js/14.72936d94.js"><link rel="prefetch" href="/assets/js/140.d1ff5371.js"><link rel="prefetch" href="/assets/js/141.07d44f72.js"><link rel="prefetch" href="/assets/js/142.bd7ec858.js"><link rel="prefetch" href="/assets/js/143.1eda6d83.js"><link rel="prefetch" href="/assets/js/144.e6016dc8.js"><link rel="prefetch" href="/assets/js/145.16345e61.js"><link rel="prefetch" href="/assets/js/146.4e5c1fbb.js"><link rel="prefetch" href="/assets/js/147.7b8addff.js"><link rel="prefetch" href="/assets/js/148.d89f18bc.js"><link rel="prefetch" href="/assets/js/149.16aa39c9.js"><link rel="prefetch" href="/assets/js/15.1455a614.js"><link rel="prefetch" href="/assets/js/150.af033679.js"><link rel="prefetch" href="/assets/js/151.f39200b2.js"><link rel="prefetch" href="/assets/js/152.44cf96dc.js"><link rel="prefetch" href="/assets/js/153.457e10b6.js"><link rel="prefetch" href="/assets/js/154.1cec3035.js"><link rel="prefetch" href="/assets/js/155.354fe04b.js"><link rel="prefetch" href="/assets/js/156.b3bc775a.js"><link rel="prefetch" href="/assets/js/157.eb262a26.js"><link rel="prefetch" href="/assets/js/158.35756e8c.js"><link rel="prefetch" href="/assets/js/159.6ac43664.js"><link rel="prefetch" href="/assets/js/16.6680f10a.js"><link rel="prefetch" href="/assets/js/160.0a56c40c.js"><link rel="prefetch" href="/assets/js/161.8320b48a.js"><link rel="prefetch" href="/assets/js/162.09ba1172.js"><link rel="prefetch" href="/assets/js/163.416663c6.js"><link rel="prefetch" href="/assets/js/164.1421ab77.js"><link rel="prefetch" href="/assets/js/165.647c9a20.js"><link rel="prefetch" href="/assets/js/166.669369b3.js"><link rel="prefetch" href="/assets/js/167.43b66e59.js"><link rel="prefetch" href="/assets/js/168.4eb162d3.js"><link rel="prefetch" href="/assets/js/169.c7a66941.js"><link rel="prefetch" href="/assets/js/17.da61c942.js"><link rel="prefetch" href="/assets/js/170.73601522.js"><link rel="prefetch" href="/assets/js/171.672fc257.js"><link rel="prefetch" href="/assets/js/172.dfa9d8d9.js"><link rel="prefetch" href="/assets/js/173.61a6ec8e.js"><link rel="prefetch" href="/assets/js/174.c7d35be8.js"><link rel="prefetch" href="/assets/js/175.675d01d1.js"><link rel="prefetch" href="/assets/js/176.8ced0887.js"><link rel="prefetch" href="/assets/js/177.4355dadd.js"><link rel="prefetch" href="/assets/js/178.79ed29b8.js"><link rel="prefetch" href="/assets/js/179.d181a862.js"><link rel="prefetch" href="/assets/js/18.6e554767.js"><link rel="prefetch" href="/assets/js/180.637e4cf5.js"><link rel="prefetch" href="/assets/js/181.c1ba49a3.js"><link rel="prefetch" href="/assets/js/182.0bc317bc.js"><link rel="prefetch" href="/assets/js/183.26e73d50.js"><link rel="prefetch" href="/assets/js/184.5a3c1539.js"><link rel="prefetch" href="/assets/js/185.f6dc87bd.js"><link rel="prefetch" href="/assets/js/186.e3b7de00.js"><link rel="prefetch" href="/assets/js/187.0c9a75a0.js"><link rel="prefetch" href="/assets/js/188.d3f8b0e3.js"><link rel="prefetch" href="/assets/js/189.1112499f.js"><link rel="prefetch" href="/assets/js/19.f800e0d1.js"><link rel="prefetch" href="/assets/js/190.e3255e84.js"><link rel="prefetch" href="/assets/js/191.34deece6.js"><link rel="prefetch" href="/assets/js/192.69821c0e.js"><link rel="prefetch" href="/assets/js/193.769a5088.js"><link rel="prefetch" href="/assets/js/194.afaa2cde.js"><link rel="prefetch" href="/assets/js/195.5b94bbc6.js"><link rel="prefetch" href="/assets/js/196.3b078264.js"><link rel="prefetch" href="/assets/js/197.2d9585d3.js"><link rel="prefetch" href="/assets/js/198.3095d8b8.js"><link rel="prefetch" href="/assets/js/199.79b6db11.js"><link rel="prefetch" href="/assets/js/20.4a74a968.js"><link rel="prefetch" href="/assets/js/200.0519b0fd.js"><link rel="prefetch" href="/assets/js/201.f536d2cf.js"><link rel="prefetch" href="/assets/js/202.801fb3ea.js"><link rel="prefetch" href="/assets/js/203.5c680311.js"><link rel="prefetch" href="/assets/js/204.656fc2b2.js"><link rel="prefetch" href="/assets/js/205.000fb7ac.js"><link rel="prefetch" href="/assets/js/206.8f945829.js"><link rel="prefetch" href="/assets/js/207.74942b2e.js"><link rel="prefetch" href="/assets/js/208.329d8230.js"><link rel="prefetch" href="/assets/js/209.78aaff0e.js"><link rel="prefetch" href="/assets/js/21.5f725cbd.js"><link rel="prefetch" href="/assets/js/210.a9bab61b.js"><link rel="prefetch" href="/assets/js/211.dbca6fcb.js"><link rel="prefetch" href="/assets/js/212.a5a00223.js"><link rel="prefetch" href="/assets/js/213.ac053291.js"><link rel="prefetch" href="/assets/js/214.611a35fb.js"><link rel="prefetch" href="/assets/js/215.f79a9f76.js"><link rel="prefetch" href="/assets/js/216.2dd7a885.js"><link rel="prefetch" href="/assets/js/217.b60bb468.js"><link rel="prefetch" href="/assets/js/218.754280d1.js"><link rel="prefetch" href="/assets/js/219.98de5ae7.js"><link rel="prefetch" href="/assets/js/22.7d2b7a74.js"><link rel="prefetch" href="/assets/js/220.ddbcfe4f.js"><link rel="prefetch" href="/assets/js/221.c865a19c.js"><link rel="prefetch" href="/assets/js/222.0961ef3f.js"><link rel="prefetch" href="/assets/js/223.b1d118ac.js"><link rel="prefetch" href="/assets/js/224.91f8eeee.js"><link rel="prefetch" href="/assets/js/225.cfe12606.js"><link rel="prefetch" href="/assets/js/226.b6bd41b4.js"><link rel="prefetch" href="/assets/js/227.0f06da2f.js"><link rel="prefetch" href="/assets/js/228.ad7ead79.js"><link rel="prefetch" href="/assets/js/229.50811bf5.js"><link rel="prefetch" href="/assets/js/23.79a6d46f.js"><link rel="prefetch" href="/assets/js/230.b7e4f198.js"><link rel="prefetch" href="/assets/js/231.e3555672.js"><link rel="prefetch" href="/assets/js/232.42df48c8.js"><link rel="prefetch" href="/assets/js/233.d3be0c78.js"><link rel="prefetch" href="/assets/js/234.33b7c938.js"><link rel="prefetch" href="/assets/js/235.843d39b6.js"><link rel="prefetch" href="/assets/js/236.463267f5.js"><link rel="prefetch" href="/assets/js/237.91666994.js"><link rel="prefetch" href="/assets/js/238.dc3f3a8f.js"><link rel="prefetch" href="/assets/js/239.549a5e0a.js"><link rel="prefetch" href="/assets/js/24.ecc90e0d.js"><link rel="prefetch" href="/assets/js/240.44f7b333.js"><link rel="prefetch" href="/assets/js/241.2d307b1a.js"><link rel="prefetch" href="/assets/js/242.42340d4b.js"><link rel="prefetch" href="/assets/js/243.ee9ccf21.js"><link rel="prefetch" href="/assets/js/244.ea68f47b.js"><link rel="prefetch" href="/assets/js/245.3af8d602.js"><link rel="prefetch" href="/assets/js/246.6f3afac5.js"><link rel="prefetch" href="/assets/js/247.a475905a.js"><link rel="prefetch" href="/assets/js/248.144c2842.js"><link rel="prefetch" href="/assets/js/249.35bae652.js"><link rel="prefetch" href="/assets/js/25.36b1065b.js"><link rel="prefetch" href="/assets/js/250.f89a1cd3.js"><link rel="prefetch" href="/assets/js/251.741b0e8e.js"><link rel="prefetch" href="/assets/js/252.1ed96448.js"><link rel="prefetch" href="/assets/js/253.9d736b7d.js"><link rel="prefetch" href="/assets/js/254.3963f173.js"><link rel="prefetch" href="/assets/js/255.5a6b4b8a.js"><link rel="prefetch" href="/assets/js/256.370bdaaf.js"><link rel="prefetch" href="/assets/js/257.63559614.js"><link rel="prefetch" href="/assets/js/258.b6958ba1.js"><link rel="prefetch" href="/assets/js/259.d1e9e2b6.js"><link rel="prefetch" href="/assets/js/26.5c4e99ce.js"><link rel="prefetch" href="/assets/js/260.a8e9559d.js"><link rel="prefetch" href="/assets/js/261.b051c6dd.js"><link rel="prefetch" href="/assets/js/262.e83c7ca8.js"><link rel="prefetch" href="/assets/js/263.bd14a165.js"><link rel="prefetch" href="/assets/js/264.65c3b624.js"><link rel="prefetch" href="/assets/js/265.db4371b9.js"><link rel="prefetch" href="/assets/js/266.e0e6c4b1.js"><link rel="prefetch" href="/assets/js/267.bb2cf1cd.js"><link rel="prefetch" href="/assets/js/268.2bdd86cb.js"><link rel="prefetch" href="/assets/js/269.54d68abe.js"><link rel="prefetch" href="/assets/js/27.fa37605f.js"><link rel="prefetch" href="/assets/js/270.befb8d53.js"><link rel="prefetch" href="/assets/js/271.774b343c.js"><link rel="prefetch" href="/assets/js/272.d8c6ee3f.js"><link rel="prefetch" href="/assets/js/273.87dee0ba.js"><link rel="prefetch" href="/assets/js/274.05747607.js"><link rel="prefetch" href="/assets/js/275.5a06ac7e.js"><link rel="prefetch" href="/assets/js/276.52a94658.js"><link rel="prefetch" href="/assets/js/277.c47416fc.js"><link rel="prefetch" href="/assets/js/278.8c7face4.js"><link rel="prefetch" href="/assets/js/279.4ec55801.js"><link rel="prefetch" href="/assets/js/28.0b75aa73.js"><link rel="prefetch" href="/assets/js/280.edb2e46a.js"><link rel="prefetch" href="/assets/js/281.c7ca5292.js"><link rel="prefetch" href="/assets/js/282.d105ef08.js"><link rel="prefetch" href="/assets/js/283.ae8d69c7.js"><link rel="prefetch" href="/assets/js/284.8763c337.js"><link rel="prefetch" href="/assets/js/285.cce4e007.js"><link rel="prefetch" href="/assets/js/29.42b5bf54.js"><link rel="prefetch" href="/assets/js/3.a2af090e.js"><link rel="prefetch" href="/assets/js/30.8084077b.js"><link rel="prefetch" href="/assets/js/31.1bf6d4e7.js"><link rel="prefetch" href="/assets/js/32.a84f73e3.js"><link rel="prefetch" href="/assets/js/33.daefe869.js"><link rel="prefetch" href="/assets/js/34.0ff2c3de.js"><link rel="prefetch" href="/assets/js/35.8fc12d56.js"><link rel="prefetch" href="/assets/js/36.bba826d5.js"><link rel="prefetch" href="/assets/js/37.c93a329a.js"><link rel="prefetch" href="/assets/js/38.58825ac3.js"><link rel="prefetch" href="/assets/js/39.d6575cdd.js"><link rel="prefetch" href="/assets/js/4.c72bd387.js"><link rel="prefetch" href="/assets/js/40.c9050587.js"><link rel="prefetch" href="/assets/js/41.28dd81aa.js"><link rel="prefetch" href="/assets/js/42.740be6ab.js"><link rel="prefetch" href="/assets/js/43.9403ca35.js"><link rel="prefetch" href="/assets/js/44.8cb7425d.js"><link rel="prefetch" href="/assets/js/45.825dfcf1.js"><link rel="prefetch" href="/assets/js/46.66695101.js"><link rel="prefetch" href="/assets/js/47.10fc5624.js"><link rel="prefetch" href="/assets/js/48.83e0285e.js"><link rel="prefetch" href="/assets/js/49.ae03334d.js"><link rel="prefetch" href="/assets/js/5.0db6077d.js"><link rel="prefetch" href="/assets/js/50.ed5827eb.js"><link rel="prefetch" href="/assets/js/51.bdf3be7e.js"><link rel="prefetch" href="/assets/js/52.eb735060.js"><link rel="prefetch" href="/assets/js/53.cc3681b0.js"><link rel="prefetch" href="/assets/js/54.63adbca5.js"><link rel="prefetch" href="/assets/js/55.be34e2fb.js"><link rel="prefetch" href="/assets/js/56.128870fa.js"><link rel="prefetch" href="/assets/js/57.b300ef9c.js"><link rel="prefetch" href="/assets/js/58.81bd7904.js"><link rel="prefetch" href="/assets/js/59.70dbb237.js"><link rel="prefetch" href="/assets/js/6.bfb6068f.js"><link rel="prefetch" href="/assets/js/60.a99ae813.js"><link rel="prefetch" href="/assets/js/61.7d2487ff.js"><link rel="prefetch" href="/assets/js/62.37537ac3.js"><link rel="prefetch" href="/assets/js/63.2db1f8c0.js"><link rel="prefetch" href="/assets/js/64.407003ca.js"><link rel="prefetch" href="/assets/js/65.ba6c5d7d.js"><link rel="prefetch" href="/assets/js/66.56619543.js"><link rel="prefetch" href="/assets/js/67.caa0061a.js"><link rel="prefetch" href="/assets/js/68.2d091e0b.js"><link rel="prefetch" href="/assets/js/69.a57aa6b8.js"><link rel="prefetch" href="/assets/js/7.4526cdd2.js"><link rel="prefetch" href="/assets/js/70.52f1d299.js"><link rel="prefetch" href="/assets/js/71.6d585528.js"><link rel="prefetch" href="/assets/js/72.4df725b6.js"><link rel="prefetch" href="/assets/js/73.3a855c11.js"><link rel="prefetch" href="/assets/js/74.6ce7dd46.js"><link rel="prefetch" href="/assets/js/75.a5d5f834.js"><link rel="prefetch" href="/assets/js/76.f3f9ccd6.js"><link rel="prefetch" href="/assets/js/77.986d5249.js"><link rel="prefetch" href="/assets/js/78.7b356dfe.js"><link rel="prefetch" href="/assets/js/79.aa93ac07.js"><link rel="prefetch" href="/assets/js/8.b5df55d0.js"><link rel="prefetch" href="/assets/js/80.83b14552.js"><link rel="prefetch" href="/assets/js/81.05e41e66.js"><link rel="prefetch" href="/assets/js/82.8832e77c.js"><link rel="prefetch" href="/assets/js/83.1f1d07d6.js"><link rel="prefetch" href="/assets/js/84.26db1aa8.js"><link rel="prefetch" href="/assets/js/85.c8f1f3bb.js"><link rel="prefetch" href="/assets/js/86.fd1c3c7f.js"><link rel="prefetch" href="/assets/js/87.38ab6ed9.js"><link rel="prefetch" href="/assets/js/88.f0a874e0.js"><link rel="prefetch" href="/assets/js/89.2b3352d4.js"><link rel="prefetch" href="/assets/js/9.c9b12f2d.js"><link rel="prefetch" href="/assets/js/90.1108430f.js"><link rel="prefetch" href="/assets/js/91.5bb55fca.js"><link rel="prefetch" href="/assets/js/92.29bc2389.js"><link rel="prefetch" href="/assets/js/93.6d335097.js"><link rel="prefetch" href="/assets/js/94.89ab26c7.js"><link rel="prefetch" href="/assets/js/95.f2493183.js"><link rel="prefetch" href="/assets/js/96.6662ec36.js"><link rel="prefetch" href="/assets/js/97.22c9d3f9.js"><link rel="prefetch" href="/assets/js/98.0b0b77a2.js"><link rel="prefetch" href="/assets/js/99.df5f5981.js">
    <link rel="stylesheet" href="/assets/css/0.styles.67a062f1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/logo.png" alt="前端档案" class="logo"> <span class="site-name can-hide">前端档案</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/fe/" class="nav-link router-link-active">
  前端
</a></div><div class="nav-item"><a href="/be/" class="nav-link">
  后端
</a></div><div class="nav-item"><a href="/base/" class="nav-link">
  基础
</a></div><div class="nav-item"><a href="/tools/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/resume/" class="nav-link">
  简历
</a></div><div class="nav-item"><a href="/experience/" class="nav-link">
  面经
</a></div><div class="nav-item"><a href="/technology/" class="nav-link">
  八股文
</a></div><div class="nav-item"><a href="/thinks/" class="nav-link">
  思考
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link">
  指南
</a></div><div class="nav-item"><a href="/fe/" class="nav-link router-link-active">
  前端
</a></div><div class="nav-item"><a href="/be/" class="nav-link">
  后端
</a></div><div class="nav-item"><a href="/base/" class="nav-link">
  基础
</a></div><div class="nav-item"><a href="/tools/" class="nav-link">
  工具
</a></div><div class="nav-item"><a href="/resume/" class="nav-link">
  简历
</a></div><div class="nav-item"><a href="/experience/" class="nav-link">
  面经
</a></div><div class="nav-item"><a href="/technology/" class="nav-link">
  八股文
</a></div><div class="nav-item"><a href="/thinks/" class="nav-link">
  思考
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/fe/" aria-current="page" class="sidebar-link">大前端学习路径 + B站资源整合</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ES6</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue3</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Webpack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Node.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>性能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>手写代码</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="jsbridge"><a href="#jsbridge" class="header-anchor">#</a> JSBridge</h1> <p>关于 JSBridge，绝大多数同学最早遇到的是微信的 WeiXinJSBridge（现在被封装成 JSSDK），各种 Web 页面可以通过 Bridge 调用微信提供的一些原生功能，为用户提供相关的功能。其实，JSBridge 很早就出现在软件开发中，在一些桌面软件中很早就运用了这样的形式，多用在通知、产品详情、广告等模块中，然后这些模块中，使用的是 Web UI，而相关按钮点击后，调用的是 Native 功能。现在移动端盛行，不管是 Hybrid 应用，还是 React-Native 都离不开 JSBridge，当然也包括在国内举足轻重的微信小程序。那么，JSBridge 到底是什么？它的出现是为了什么？它究竟是怎么实现的？在这篇文章中，会在移动混合开发的范畴内，将给大家带来 JSBridge 的深入剖析。</p> <p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/3/29/16270f34f02109eb~tplv-t2oaga2asx-watermark.awebp" alt="img"></p> <p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/3/29/16270f45ca45db54~tplv-t2oaga2asx-watermark.awebp" alt="img"></p> <h2 id="_1-前言"><a href="#_1-前言" class="header-anchor">#</a> 1 前言</h2> <p>有些童鞋听到 JSBridge 这个名词，就是觉得非常高上大，有了它 Web 和 Native 可以进行交互，就像『进化药水』，让 Web 摇身一变，成为移动战场的『上将一名』。其实并非如此，JSBridge 其实真是一个很简单的东西，更多的是一种形式、一种思想。</p> <h2 id="_2-jsbridge-的起源"><a href="#_2-jsbridge-的起源" class="header-anchor">#</a> 2 JSBridge 的起源</h2> <p>为什么是 JSBridge ？而不是 PythonBridge 或是 RubyBridge ？</p> <p>当然不是因为 JavaScript 语言高人一等（虽然斯坦福大学已经把算法导论的语言从 Java 改成 JavaScript，小得意一下，嘻嘻），主要的原因还是因为 JavaScript 主要载体 Web 是当前世界上的 <strong>最易编写</strong> 、 <strong>最易维护</strong> 、<strong>最易部署</strong> 的 UI 构建方式。工程师可以用很简单的 HTML 标签和 CSS 样式快速的构建出一个页面，并且在服务端部署后，用户不需要主动更新，就能看到最新的 UI 展现。</p> <p>因此，<strong>开发维护成本</strong> 和 <strong>更新成本</strong> 较低的 Web 技术成为混合开发中几乎不二的选择，而作为 Web 技术逻辑核心的 JavaScript 也理所应当肩负起与其他技术『桥接』的职责，并且作为移动不可缺少的一部分，任何一个移动操作系统中都包含可运行 JavaScript 的容器，例如 WebView 和 JSCore。所以，运行 JavaScript 不用像运行其他语言时，要额外添加运行环境。因此，基于上面种种原因，JSBridge 应运而生。</p> <p>PhoneGap（Codova 的前身）作为 Hybrid 鼻祖框架，应该是最先被开发者广泛认知的 JSBridge 的应用场景；而对于 JSBridge 的应用在国内真正兴盛起来，则是因为杀手级应用微信的出现，主要用途是在网页中通过 JSBridge 设置分享内容。</p> <p>移动端混合开发中的 JSBridge，主要被应用在两种形式的技术方案上：</p> <ul><li><p>基于 Web 的 Hybrid 解决方案：例如微信浏览器、各公司的 Hybrid 方案</p></li> <li><p>非基于 Web UI 但业务逻辑基于 JavaScript 的解决方案：例如 React-Native</p></li></ul> <p>【注】：微信小程序基于 Web UI，但是为了追求运行效率，对 UI 展现逻辑和业务逻辑的 JavaScript 进行了隔离。因此小程序的技术方案介于上面描述的两种方式之间。</p> <h2 id="_3-jsbridge-的用途"><a href="#_3-jsbridge-的用途" class="header-anchor">#</a> 3 JSBridge 的用途</h2> <p>JSBridge 简单来讲，主要是 <strong>给 JavaScript 提供调用 Native 功能的接口</strong>，让混合开发中的『前端部分』可以方便地使用地址位置、摄像头甚至支付等 Native 功能。</p> <p>既然是『简单来讲』，那么 JSBridge 的用途肯定不只『调用 Native 功能』这么简单宽泛。实际上，JSBridge 就像其名称中的『Bridge』的意义一样，是 Native 和非 Native 之间的桥梁，它的核心是 <strong>构建 Native 和非 Native 间消息通信的通道</strong>，而且是 <strong>双向通信的通道</strong>。</p> <p><img src="https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2018/3/29/16270f744a3e61f2~tplv-t2oaga2asx-watermark.awebp" alt="img"></p> <p>所谓 <strong>双向通信的通道</strong>:</p> <ul><li><p>JS 向 Native 发送消息 : 调用相关功能、通知 Native 当前 JS 的相关状态等。</p></li> <li><p>Native 向 JS 发送消息 : 回溯调用结果、消息推送、通知 JS 当前 Native 的状态等。</p></li></ul> <p>这里有些同学有疑问了：<em>消息都是单向的，那么调用 Native 功能时 Callback 怎么实现的？</em> 对于这个问题，在下一节里会给出解释。</p> <h2 id="_4-jsbridge-的实现原理"><a href="#_4-jsbridge-的实现原理" class="header-anchor">#</a> 4 JSBridge 的实现原理</h2> <p>JavaScript 是运行在一个单独的 JS Context 中（例如，WebView 的 Webkit 引擎、JSCore）。由于这些 Context 与原生运行环境的天然隔离，我们可以将这种情况与 RPC（Remote Procedure Call，远程过程调用）通信进行类比，将 Native 与 JavaScript 的每次互相调用看做一次 RPC 调用。</p> <p>在 JSBridge 的设计中，可以把前端看做 RPC 的客户端，把 Native 端看做 RPC 的服务器端，从而 JSBridge 要实现的主要逻辑就出现了：<strong>通信调用（Native 与 JS 通信）</strong> 和 <strong>句柄解析调用</strong>。（如果你是个前端，而且并不熟悉 RPC 的话，你也可以把这个流程类比成 JSONP 的流程）</p> <p>通过以上的分析，可以清楚地知晓 JSBridge 主要的功能和职责，接下来就以 <strong>Hybrid 方案</strong> 为案例从这几点来剖析 JSBridge 的实现原理。</p> <h3 id="_4-1-jsbridge-的通信原理"><a href="#_4-1-jsbridge-的通信原理" class="header-anchor">#</a> 4.1 JSBridge 的通信原理</h3> <p>**Hybrid 方案是基于 WebView 的，JavaScript 执行在 WebView 的 Webkit 引擎中。**因此，Hybrid 方案中 JSBridge 的通信原理会具有一些 Web 特性。</p> <h4 id="_4-1-1-javascript-调用-native"><a href="#_4-1-1-javascript-调用-native" class="header-anchor">#</a> 4.1.1 JavaScript 调用 Native</h4> <p>JavaScript 调用 Native 的方式，主要有两种：<strong>注入 API</strong> 和 <strong>拦截 URL SCHEME</strong>。</p> <h5 id="_4-1-1-1-注入api"><a href="#_4-1-1-1-注入api" class="header-anchor">#</a> 4.1.1.1 注入API</h5> <p>注入 API 方式的主要原理是，通过 WebView 提供的接口，向 JavaScript 的 Context（window）中注入对象或者方法，让 JavaScript 调用时，直接执行相应的 Native 代码逻辑，达到 JavaScript 调用 Native 的目的。</p> <p>对于 iOS 的 UIWebView，实例如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>JSContext <span class="token operator">*</span>context <span class="token operator">=</span> <span class="token punctuation">[</span>uiWebView valueForKeyPath<span class="token operator">:</span>@<span class="token string">&quot;documentView.webView.mainFrame.javaScriptContext&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

context<span class="token punctuation">[</span>@<span class="token string">&quot;postBridgeMessage&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">^</span><span class="token punctuation">(</span>NSArray<span class="token operator">&lt;</span>NSArray <span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token operator">*</span>calls<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Native 逻辑</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>前端调用方式：</p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">postBridgeMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>对于 iOS 的 WKWebView 可以用以下方式：</p> <div class="language-js extra-class"><pre class="language-js"><code>@<span class="token keyword">interface</span> <span class="token class-name">WKWebVIewVC</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>WKScriptMessageHandler<span class="token operator">&gt;</span>

@implementation WKWebVIewVC

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>viewDidLoad <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token keyword">super</span> viewDidLoad<span class="token punctuation">]</span><span class="token punctuation">;</span>

    WKWebViewConfiguration<span class="token operator">*</span> configuration <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>WKWebViewConfiguration alloc<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>
    configuration<span class="token punctuation">.</span>userContentController <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>WKUserContentController alloc<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>
    WKUserContentController <span class="token operator">*</span>userCC <span class="token operator">=</span> configuration<span class="token punctuation">.</span>userContentController<span class="token punctuation">;</span>
    <span class="token comment">// 注入对象，前端调用其方法时，Native 可以捕获到</span>
    <span class="token punctuation">[</span>userCC addScriptMessageHandler<span class="token operator">:</span>self name<span class="token operator">:</span>@<span class="token string">&quot;nativeBridge&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    WKWebView wkWebView <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>WKWebView alloc<span class="token punctuation">]</span> initWithFrame<span class="token operator">:</span>self<span class="token punctuation">.</span>view<span class="token punctuation">.</span>frame configuration<span class="token operator">:</span>configuration<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// TODO 显示 WebView</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>userContentController<span class="token operator">:</span><span class="token punctuation">(</span>WKUserContentController <span class="token operator">*</span><span class="token punctuation">)</span>userContentController didReceiveScriptMessage<span class="token operator">:</span><span class="token punctuation">(</span>WKScriptMessage <span class="token operator">*</span><span class="token punctuation">)</span>message <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>message<span class="token punctuation">.</span>name isEqualToString<span class="token operator">:</span>@<span class="token string">&quot;nativeBridge&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">NSLog</span><span class="token punctuation">(</span>@<span class="token string">&quot;前端传递的数据 %@: &quot;</span><span class="token punctuation">,</span>message<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Native 逻辑</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>前端调用方式：</p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span>webkit<span class="token punctuation">.</span>messageHandlers<span class="token punctuation">.</span>nativeBridge<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>对于 Android 可以采用下面的方式：</p> <div class="language-js extra-class"><pre class="language-js"><code>publicclassJavaScriptInterfaceDemoActivityextendsActivity<span class="token punctuation">{</span>
<span class="token keyword">private</span> WebView Wv<span class="token punctuation">;</span>

    @Override
    <span class="token function">publicvoidonCreate</span><span class="token punctuation">(</span><span class="token parameter">Bundle savedInstanceState</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>

        Wv <span class="token operator">=</span> <span class="token punctuation">(</span>WebView<span class="token punctuation">)</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token constant">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>webView<span class="token punctuation">)</span><span class="token punctuation">;</span>     
        final JavaScriptInterface myJavaScriptInterface <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JavaScriptInterface</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      

        Wv<span class="token punctuation">.</span><span class="token function">getSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setJavaScriptEnabled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Wv<span class="token punctuation">.</span><span class="token function">addJavascriptInterface</span><span class="token punctuation">(</span>myJavaScriptInterface<span class="token punctuation">,</span> <span class="token string">&quot;nativeBridge&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// TODO 显示 WebView</span>

    <span class="token punctuation">}</span>

    publicclassJavaScriptInterface<span class="token punctuation">{</span>
         Context mContext<span class="token punctuation">;</span>

         <span class="token function">JavaScriptInterface</span><span class="token punctuation">(</span><span class="token parameter">Context c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
             mContext <span class="token operator">=</span> c<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>

         <span class="token function">publicvoidpostMessage</span><span class="token punctuation">(</span><span class="token parameter">String webMessage</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      
             <span class="token comment">// Native 逻辑</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>前端调用方式：</p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span>nativeBridge<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在 4.2 之前，Android 注入 JavaScript 对象的接口是 addJavascriptInterface，但是这个接口有漏洞，可以被不法分子利用，危害用户的安全，因此在 4.2 中引入新的接口 @JavascriptInterface（上面代码中使用的）来替代这个接口，解决安全问题。所以 Android 注入对对象的方式是 <strong>有兼容性问题的</strong>。（4.2 之前很多方案都采用拦截 prompt 的方式来实现，因为篇幅有限，这里就不展开了。）</p> <h5 id="_4-1-1-2-拦截-url-scheme"><a href="#_4-1-1-2-拦截-url-scheme" class="header-anchor">#</a> 4.1.1.2 拦截 URL SCHEME</h5> <p>先解释一下 URL SCHEME：URL SCHEME是一种类似于url的链接，是为了方便app直接互相调用设计的，形式和普通的 url 近似，主要区别是 protocol 和 host 一般是自定义的，例如: qunarhy://hy/url?url=<a href="https://link.juejin.cn/?target=http%3A%2F%2Fymfe.tech" target="_blank" rel="noopener noreferrer">ymfe.tech<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，protocol 是 qunarhy，host 则是 hy。</p> <p>拦截 URL SCHEME 的主要流程是：Web 端通过某种方式（例如 iframe.src）发送 URL Scheme 请求，之后 Native 拦截到请求并根据 URL SCHEME（包括所带的参数）进行相关操作。</p> <p>在时间过程中，这种方式有一定的 <strong>缺陷</strong>：</p> <ul><li><p>使用 iframe.src 发送 URL SCHEME 会有 url 长度的隐患。</p></li> <li><p>创建请求，需要一定的耗时，比注入 API 的方式调用同样的功能，耗时会较长。</p></li></ul> <p>但是之前为什么很多方案使用这种方式呢？因为它 <strong>支持 iOS6</strong>。而现在的大环境下，iOS6 占比很小，基本上可以忽略，所以并不推荐为了 iOS6 使用这种 <strong>并不优雅</strong> 的方式。</p> <p>【注】：有些方案为了规避 url 长度隐患的缺陷，在 iOS 上采用了使用 Ajax 发送同域请求的方式，并将参数放到 head 或 body 里。这样，虽然规避了 url 长度的隐患，但是 WKWebView 并不支持这样的方式。</p> <p>【注2】：为什么选择 iframe.src 不选择 locaiton.href ？因为如果通过 location.href 连续调用 Native，很容易丢失一些调用。</p> <h4 id="_4-1-2-native-调用-javascript"><a href="#_4-1-2-native-调用-javascript" class="header-anchor">#</a> 4.1.2 Native 调用 JavaScript</h4> <p>相比于 JavaScript 调用 Native， Native 调用 JavaScript 较为简单，毕竟不管是 iOS 的 UIWebView 还是 WKWebView，还是 Android 的 WebView 组件，都以子组件的形式存在于 View/Activity 中，直接调用相应的 API 即可。</p> <p>Native 调用 JavaScript，其实就是执行拼接 JavaScript 字符串，从外部调用 JavaScript 中的方法，因此 JavaScript 的方法必须在全局的 window 上。（闭包里的方法，JavaScript 自己都调用不了，更不用想让 Native 去调用了）</p> <p>对于 iOS 的 UIWebView，示例如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>result <span class="token operator">=</span> <span class="token punctuation">[</span>uiWebview stringByEvaluatingJavaScriptFromString<span class="token operator">:</span>javaScriptString<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>对于 iOS 的 WKWebView，示例如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span>wkWebView evaluateJavaScript<span class="token operator">:</span>javaScriptString completionHandler<span class="token operator">:</span>completionHandler<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>对于 Android，在 Kitkat（4.4）之前并没有提供 iOS 类似的调用方式，只能用 loadUrl 一段 JavaScript 代码，来实现：</p> <div class="language-js extra-class"><pre class="language-js"><code>webView<span class="token punctuation">.</span><span class="token function">loadUrl</span><span class="token punctuation">(</span><span class="token string">&quot;javascript:&quot;</span> <span class="token operator">+</span> javaScriptString<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>而 Kitkat 之后的版本，也可以用 evaluateJavascript 方法实现：</p> <div class="language-js extra-class"><pre class="language-js"><code>webView<span class="token punctuation">.</span><span class="token function">evaluateJavascript</span><span class="token punctuation">(</span>javaScriptString<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ValueCallback</span><span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    @Override
    <span class="token function">publicvoidonReceiveValue</span><span class="token punctuation">(</span><span class="token parameter">String value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>【注】：使用 loadUrl 的方式，并不能获取 JavaScript 执行后的结果。</p> <h4 id="_4-1-3-通信原理小总结"><a href="#_4-1-3-通信原理小总结" class="header-anchor">#</a> 4.1.3 通信原理小总结</h4> <p>通信原理是 JSBridge 实现的核心，实现方式可以各种各样，但是万变不离其宗。这里，笔者推荐的实现方式如下：</p> <ul><li><p>JavaScript 调用 Native 推荐使用 <strong>注入 API</strong> 的方式（iOS6 忽略，Android 4.2以下使用 WebViewClient 的 onJsPrompt 方式）。</p></li> <li><p>Native 调用 JavaScript 则直接执行拼接好的 JavaScript 代码即可。</p></li></ul> <p>对于其他方式，诸如 React Native、微信小程序 的通信方式都与上描述的近似，并根据实际情况进行优化。</p> <p>以 React Native 的 iOS 端举例：JavaScript 运行在 JSCore 中，实际上可以与上面的方式一样，利用注入 API 来实现 JavaScript 调用 Native 功能。不过 React Native 并没有设计成 JavaScript 直接调用 Object-C，而是 <strong>为了与 Native 开发里事件响应机制一致</strong>，设计成 <strong>需要在 Object-C 去调 JavaScript 时才通过返回值触发调用</strong>。原理基本一样，只是实现方式不同。</p> <p>当然不仅仅 iOS 和 Android，其他手机操作系统也用相应的 API，例如 WMP（Win 10）下可以用 window.external.notify 和 WebView.InvokeScript/InvokeScriptAsync 进行双向通信。其他系统也类似。</p> <h3 id="_4-2-jsbridge-接口实现"><a href="#_4-2-jsbridge-接口实现" class="header-anchor">#</a> 4.2 JSBridge 接口实现</h3> <p>从上面的剖析中，可以得知，JSBridge 的接口主要功能有两个：<strong>调用 Native（给 Native 发消息）</strong> 和 <strong>接收 Native 调用（接收 Native 消息）</strong>。因此，JSBridge 可以设计如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span>JSBridge <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// 调用 Native</span>
    <span class="token function-variable function">invoke</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 判断环境，获取不同的 nativeBridge</span>
        nativeBridge<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">receiveMessage</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 处理 msg</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>在上面的文章中，提到过 RPC 中有一个非常重要的环节是 <strong>句柄解析调用</strong> ，这点在 JSBridge 中体现为 <strong>句柄与功能对应关系</strong>。同时，我们将句柄抽象为 <strong>桥名（BridgeName）</strong>，最终演化为 <strong>一个 BridgeName 对应一个 Native 功能或者一类 Native 消息</strong>。 基于此点，JSBridge 的实现可以优化为如下：</p> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span>JSBridge <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// 调用 Native</span>
    <span class="token function-variable function">invoke</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bridgeName<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 判断环境，获取不同的 nativeBridge</span>
        nativeBridge<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            bridgeName<span class="token operator">:</span> bridgeName<span class="token punctuation">,</span>
            data<span class="token operator">:</span> data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">receiveMessage</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> bridgeName <span class="token operator">=</span> msg<span class="token punctuation">.</span>bridgeName<span class="token punctuation">,</span>
            data <span class="token operator">=</span> msg<span class="token punctuation">.</span>data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token comment">// 具体逻辑</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>JSBridge 大概的雏形出现了。现在终于可以着手解决这个问题了：<strong>消息都是单向的，那么调用 Native 功能时 Callback 怎么实现的？</strong></p> <p>对于 JSBridge 的 Callback ，其实就是 RPC 框架的回调机制。当然也可以用更简单的 JSONP 机制解释：</p> <blockquote><p>当发送 JSONP 请求时，url 参数里会有 callback 参数，其值是 <strong>当前页面唯一</strong> 的，而同时以此参数值为 key 将回调函数存到 window 上，随后，服务器返回 script 中，也会以此参数值作为句柄，调用相应的回调函数。</p></blockquote> <p>由此可见，callback 参数这个 <strong>唯一标识</strong> 是这个回调逻辑的关键。这样，我们可以参照这个逻辑来实现 JSBridge：用一个自增的唯一 id，来标识并存储回调函数，并把此 id 以参数形式传递给 Native，而 Native 也以此 id 作为回溯的标识。这样，即可实现 Callback 回调逻辑。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
        callbacks <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    window<span class="token punctuation">.</span>JSBridge <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token comment">// 调用 Native</span>
        <span class="token function-variable function">invoke</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bridgeName<span class="token punctuation">,</span> callback<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 判断环境，获取不同的 nativeBridge</span>
            <span class="token keyword">var</span> thisId <span class="token operator">=</span> id <span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// 获取唯一 id</span>
            callbacks<span class="token punctuation">[</span>thisId<span class="token punctuation">]</span> <span class="token operator">=</span> callback<span class="token punctuation">;</span> <span class="token comment">// 存储 Callback</span>
            nativeBridge<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                bridgeName<span class="token operator">:</span> bridgeName<span class="token punctuation">,</span>
                data<span class="token operator">:</span> data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                callbackId<span class="token operator">:</span> thisId <span class="token comment">// 传到 Native 端</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">receiveMessage</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> bridgeName <span class="token operator">=</span> msg<span class="token punctuation">.</span>bridgeName<span class="token punctuation">,</span>
                data <span class="token operator">=</span> msg<span class="token punctuation">.</span>data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                callbackId <span class="token operator">=</span> msg<span class="token punctuation">.</span>callbackId<span class="token punctuation">;</span> <span class="token comment">// Native 将 callbackId 原封不动传回</span>
            <span class="token comment">// 具体逻辑</span>
            <span class="token comment">// bridgeName 和 callbackId 不会同时存在</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>callbackId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>callbacks<span class="token punctuation">[</span>callbackId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 找到相应句柄</span>
                    callbacks<span class="token punctuation">[</span>callbackId<span class="token punctuation">]</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行调用</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token function">elseif</span> <span class="token punctuation">(</span><span class="token parameter">bridgeName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>最后用同样的方式加上 Native 调用的回调逻辑，同时对代码进行一些优化，就大概实现了一个功能比较完整的 JSBridge。其代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> id <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
        callbacks <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        registerFuncs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    window<span class="token punctuation">.</span>JSBridge <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token comment">// 调用 Native</span>
        <span class="token function-variable function">invoke</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bridgeName<span class="token punctuation">,</span> callback<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 判断环境，获取不同的 nativeBridge</span>
            <span class="token keyword">var</span> thisId <span class="token operator">=</span> id <span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// 获取唯一 id</span>
            callbacks<span class="token punctuation">[</span>thisId<span class="token punctuation">]</span> <span class="token operator">=</span> callback<span class="token punctuation">;</span> <span class="token comment">// 存储 Callback</span>
            nativeBridge<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                bridgeName<span class="token operator">:</span> bridgeName<span class="token punctuation">,</span>
                data<span class="token operator">:</span> data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                callbackId<span class="token operator">:</span> thisId <span class="token comment">// 传到 Native 端</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">receiveMessage</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">var</span> bridgeName <span class="token operator">=</span> msg<span class="token punctuation">.</span>bridgeName<span class="token punctuation">,</span>
                data <span class="token operator">=</span> msg<span class="token punctuation">.</span>data <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                callbackId <span class="token operator">=</span> msg<span class="token punctuation">.</span>callbackId<span class="token punctuation">,</span> <span class="token comment">// Native 将 callbackId 原封不动传回</span>
                responstId <span class="token operator">=</span> msg<span class="token punctuation">.</span>responstId<span class="token punctuation">;</span>
            <span class="token comment">// 具体逻辑</span>
            <span class="token comment">// bridgeName 和 callbackId 不会同时存在</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>callbackId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>callbacks<span class="token punctuation">[</span>callbackId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 找到相应句柄</span>
                    callbacks<span class="token punctuation">[</span>callbackId<span class="token punctuation">]</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 执行调用</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token function">elseif</span> <span class="token punctuation">(</span><span class="token parameter">bridgeName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>registerFuncs<span class="token punctuation">[</span>bridgeName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 通过 bridgeName 找到句柄</span>
                    <span class="token keyword">var</span> ret <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                        flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    registerFuncs<span class="token punctuation">[</span>bridgeName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                        <span class="token function">callback</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">r</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                            ret <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>ret<span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        nativeBridge<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">// 回调 Native</span>
                            responstId<span class="token operator">:</span> responstId<span class="token punctuation">,</span>
                            ret<span class="token operator">:</span> ret
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">register</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bridgeName<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>registerFuncs<span class="token punctuation">[</span>bridgeName<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
                registerFuncs<span class="token punctuation">[</span>bridgeName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            registerFuncs<span class="token punctuation">[</span>bridgeName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 存储回调</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>当然，这段代码片段只是一个示例，主要用于剖析 JSBridge 的原理和流程，里面存在诸多省略和不完善的代码逻辑，读者们可以自行完善。</p> <p>【注】：这一节主要讲的是，JavaScript 端的 JSBridge 的实现，对于 Native 端涉及的并不多。在 Native 端配合实现 JSBridge 的 JavaScript 调用 Native 逻辑也很简单，主要的代码逻辑是：接收到 JavaScript 消息 =&gt; 解析参数，拿到 bridgeName、data 和 callbackId =&gt; 根据 bridgeName 找到功能方法，以 data 为参数执行 =&gt; 执行返回值和 callbackId 一起回传前端。 Native 调用 JavaScript 也同样简单，直接自动生成一个唯一的 ResponseId，并存储句柄，然后和 data 一起发送给前端即可。</p> <h2 id="_5-jsbridge-如何引用"><a href="#_5-jsbridge-如何引用" class="header-anchor">#</a> 5 JSBridge 如何引用</h2> <p>对于 JSBridge 的引用，常用有两种方式，各有利弊。</p> <h3 id="_5-1-由-native-端进行注入"><a href="#_5-1-由-native-端进行注入" class="header-anchor">#</a> 5.1 由 Native 端进行注入</h3> <p>注入方式和 Native 调用 JavaScript 类似，直接执行桥的全部代码。</p> <p>它的优点在于：桥的版本很容易与 Native 保持一致，Native 端不用对不同版本的 JSBridge 进行兼容；与此同时，它的缺点是：注入时机不确定，需要实现注入失败后重试的机制，保证注入的成功率，同时 JavaScript 端在调用接口时，需要优先判断 JSBridge 是否已经注入成功。</p> <h3 id="_5-2-由-javascript-端引用"><a href="#_5-2-由-javascript-端引用" class="header-anchor">#</a> 5.2 由 JavaScript 端引用</h3> <p>直接与 JavaScript 一起执行。</p> <p>与由 Native 端注入正好相反，它的优点在于：JavaScript 端可以确定 JSBridge 的存在，直接调用即可；缺点是：如果桥的实现方式有更改，JSBridge 需要兼容多版本的 Native Bridge 或者 Native Bridge 兼容多版本的 JSBridge。</p> <h4 id="参考文献"><a href="#参考文献" class="header-anchor">#</a> 参考文献</h4> <ul><li><a href="https://juejin.cn/post/6844903585268891662#heading-5" target="_blank" rel="noopener noreferrer">JSBridge的原理 - 掘金 (juejin.cn)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">12/2/2021, 1:38:37 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.7dfc15e8.js" defer></script><script src="/assets/js/2.db7a59af.js" defer></script><script src="/assets/js/132.fee282f7.js" defer></script>
  </body>
</html>
