<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.38">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/favicon.ico"><meta name="keyworks" content="档案馆,物流,北京到上海"><title>fastclick 解决移动端click事件300ms延迟问题 | 前端面试档案馆</title><meta name="description" content="Frontend 前端面试档案馆">
    <link rel="modulepreload" href="/assets/app.f6b3af9d.js"><link rel="modulepreload" href="/assets/mobile.html.5bfe554b.js"><link rel="modulepreload" href="/assets/mobile.html.961f4303.js">
    <link rel="stylesheet" href="/assets/style.39d5bbe5.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/logo.png" alt="前端面试档案馆"><span class="site-name can-hide">前端面试档案馆</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/posts/guide/" class="" aria-label="指南"><!--[--><!--]--> 指南 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/posts/fe/" class="" aria-label="前端"><!--[--><!--]--> 前端 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/posts/be/" class="" aria-label="后端"><!--[--><!--]--> 后端 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/posts/base/" class="router-link-active" aria-label="基础"><!--[--><!--]--> 基础 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/posts/resume/" class="" aria-label="简历"><!--[--><!--]--> 简历 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/posts/experience/" class="" aria-label="面经"><!--[--><!--]--> 面经 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/posts/tools/" class="" aria-label="工具"><!--[--><!--]--> 工具 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/posts/guide/" class="" aria-label="指南"><!--[--><!--]--> 指南 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/posts/fe/" class="" aria-label="前端"><!--[--><!--]--> 前端 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/posts/be/" class="" aria-label="后端"><!--[--><!--]--> 后端 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/posts/base/" class="router-link-active" aria-label="基础"><!--[--><!--]--> 基础 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/posts/resume/" class="" aria-label="简历"><!--[--><!--]--> 简历 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/posts/experience/" class="" aria-label="面经"><!--[--><!--]--> 面经 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/posts/tools/" class="" aria-label="工具"><!--[--><!--]--> 工具 <!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">算法 <span class="right arrow"></span></p><!--[--><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/posts/base/algorithm/" class="sidebar-item" aria-label="算法"><!--[--><!--]--> 算法 <!--[--><!--]--></a><!----></li><li><a href="/posts/base/algorithm/array.html" class="sidebar-item" aria-label="数组相关算法"><!--[--><!--]--> 数组相关算法 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading active collapsible">HTTP <span class="down arrow"></span></p><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a href="/posts/base/http/" class="router-link-active sidebar-item" aria-label="HTTP"><!--[--><!--]--> HTTP <!--[--><!--]--></a><!----></li><li><a href="/posts/base/http/1.0_1.1_2.0.html" class="sidebar-item" aria-label="HTTP 1.0/1.1/2.0"><!--[--><!--]--> HTTP 1.0/1.1/2.0 <!--[--><!--]--></a><!----></li><li><a href="/posts/base/http/after_url.html" class="sidebar-item" aria-label="页面从输入URL到页面加载显示完成，这个过程中都发生了什么？"><!--[--><!--]--> 页面从输入URL到页面加载显示完成，这个过程中都发生了什么？ <!--[--><!--]--></a><!----></li><li><a href="/posts/base/http/CDN.html" class="sidebar-item" aria-label="CDN"><!--[--><!--]--> CDN <!--[--><!--]--></a><!----></li><li><a href="/posts/base/http/cookie_session.html" class="sidebar-item" aria-label="浏览器的 cookie 和服务端的 session 有什么区别"><!--[--><!--]--> 浏览器的 cookie 和服务端的 session 有什么区别 <!--[--><!--]--></a><!----></li><li><a href="/posts/base/http/cross_domain.html" class="sidebar-item" aria-label="跨域"><!--[--><!--]--> 跨域 <!--[--><!--]--></a><!----></li><li><a href="/posts/base/http/DNS.html" class="sidebar-item" aria-label="DNS 协议"><!--[--><!--]--> DNS 协议 <!--[--><!--]--></a><!----></li><li><a href="/posts/base/http/GET_POST.html" class="sidebar-item" aria-label="GET 和 POST 请求"><!--[--><!--]--> GET 和 POST 请求 <!--[--><!--]--></a><!----></li><li><a href="/posts/base/http/handshakes_waves.html" class="sidebar-item" aria-label="三次握手和四次挥手"><!--[--><!--]--> 三次握手和四次挥手 <!--[--><!--]--></a><!----></li><li><a href="/posts/base/http/headers.html" class="sidebar-item" aria-label="HTTP 常见的请求头"><!--[--><!--]--> HTTP 常见的请求头 <!--[--><!--]--></a><!----></li><li><a href="/posts/base/http/HTTPS.html" class="sidebar-item" aria-label="HTTPS 是如何保证安全的"><!--[--><!--]--> HTTPS 是如何保证安全的 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/base/http/mobile.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="fastclick 解决移动端click事件300ms延迟问题"><!--[--><!--]--> fastclick 解决移动端click事件300ms延迟问题 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/posts/base/http/mobile.html#移动端click-事件延迟300ms" class="router-link-active router-link-exact-active sidebar-item" aria-label="移动端click 事件延迟300ms"><!--[--><!--]--> 移动端click 事件延迟300ms <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/base/http/mobile.html#产生原因" class="router-link-active router-link-exact-active sidebar-item" aria-label="产生原因"><!--[--><!--]--> 产生原因 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/posts/base/http/mobile.html#预备知识-移动端点击一个元素触发事件的顺序" class="router-link-active router-link-exact-active sidebar-item" aria-label="预备知识：移动端点击一个元素触发事件的顺序"><!--[--><!--]--> 预备知识：移动端点击一个元素触发事件的顺序 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><a aria-current="page" href="/posts/base/http/mobile.html#解决方案" class="router-link-active router-link-exact-active sidebar-item" aria-label="解决方案"><!--[--><!--]--> 解决方案 <!--[--><!--]--></a><!--[--><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/posts/base/http/mobile.html#禁用缩放" class="router-link-active router-link-exact-active sidebar-item" aria-label="禁用缩放"><!--[--><!--]--> 禁用缩放 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/base/http/mobile.html#css-touch-action" class="router-link-active router-link-exact-active sidebar-item" aria-label="css touch-action"><!--[--><!--]--> css touch-action <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/base/http/mobile.html#指针事件的-polyfill" class="router-link-active router-link-exact-active sidebar-item" aria-label="指针事件的 polyfill"><!--[--><!--]--> 指针事件的 polyfill <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/base/http/mobile.html#zepto等库的-tap事件" class="router-link-active router-link-exact-active sidebar-item" aria-label="zepto等库的 tap事件"><!--[--><!--]--> zepto等库的 tap事件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/base/http/mobile.html#fastclick-解决300ms延迟" class="router-link-active router-link-exact-active sidebar-item" aria-label="fastclick 解决300ms延迟"><!--[--><!--]--> fastclick 解决300ms延迟 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/posts/base/http/mobile.html#对比总结" class="router-link-active router-link-exact-active sidebar-item" aria-label="对比总结"><!--[--><!--]--> 对比总结 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--]--></li><li><a href="/posts/base/http/OSI.html" class="sidebar-item" aria-label="OSI"><!--[--><!--]--> OSI <!--[--><!--]--></a><!----></li><li><a href="/posts/base/http/repaint_reflow.html" class="sidebar-item" aria-label="重绘（Repaint）和回流/重排（Reflow）"><!--[--><!--]--> 重绘（Repaint）和回流/重排（Reflow） <!--[--><!--]--></a><!----></li><li><a href="/posts/base/http/security.html" class="sidebar-item" aria-label="XSS 和 CSRF"><!--[--><!--]--> XSS 和 CSRF <!--[--><!--]--></a><!----></li><li><a href="/posts/base/http/status.html" class="sidebar-item" aria-label="HTTP 状态码"><!--[--><!--]--> HTTP 状态码 <!--[--><!--]--></a><!----></li><li><a href="/posts/base/http/TCP_IP.html" class="sidebar-item" aria-label="TCP/IP协议"><!--[--><!--]--> TCP/IP协议 <!--[--><!--]--></a><!----></li><li><a href="/posts/base/http/UDP_TCP.html" class="sidebar-item" aria-label="UDP、TCP区别"><!--[--><!--]--> UDP、TCP区别 <!--[--><!--]--></a><!----></li><li><a href="/posts/base/http/WebSocket.html" class="sidebar-item" aria-label="WebSocket"><!--[--><!--]--> WebSocket <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><li><p tabindex="0" class="sidebar-item sidebar-heading collapsible">Linux <span class="right arrow"></span></p><!--[--><ul style="display:none;" class="sidebar-item-children"><!--[--><li><a href="/posts/base/linux/" class="sidebar-item" aria-label="操作系统"><!--[--><!--]--> 操作系统 <!--[--><!--]--></a><!----></li><li><a href="/posts/base/linux/file.html" class="sidebar-item" aria-label="linux系统下 文件操作常用的命令有哪些？"><!--[--><!--]--> linux系统下 文件操作常用的命令有哪些？ <!--[--><!--]--></a><!----></li><li><a href="/posts/base/linux/linux%20users.html" class="sidebar-item" aria-label="linux 用户管理"><!--[--><!--]--> linux 用户管理 <!--[--><!--]--></a><!----></li><li><a href="/posts/base/linux/redirect_pipe.html" class="sidebar-item" aria-label="输入输出重定向和管道"><!--[--><!--]--> 输入输出重定向和管道 <!--[--><!--]--></a><!----></li><li><a href="/posts/base/linux/shell.html" class="sidebar-item" aria-label="Shell"><!--[--><!--]--> Shell <!--[--><!--]--></a><!----></li><li><a href="/posts/base/linux/thread_process.html" class="sidebar-item" aria-label="进程和线程"><!--[--><!--]--> 进程和线程 <!--[--><!--]--></a><!----></li><li><a href="/posts/base/linux/vim.html" class="sidebar-item" aria-label="Vim 文本编辑"><!--[--><!--]--> Vim 文本编辑 <!--[--><!--]--></a><!----></li><!--]--></ul><!--]--></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="fastclick-解决移动端click事件300ms延迟问题" tabindex="-1"><a class="header-anchor" href="#fastclick-解决移动端click事件300ms延迟问题" aria-hidden="true">#</a> fastclick 解决移动端click事件300ms延迟问题</h1><h2 id="移动端click-事件延迟300ms" tabindex="-1"><a class="header-anchor" href="#移动端click-事件延迟300ms" aria-hidden="true">#</a> 移动端click 事件延迟300ms</h2><hr><p>一般情况下，如果没有经过特殊处理，移动端浏览器在派发点击事件的时候，通常会出现300ms左右的延迟。也就是说，当我们点击页面的时候移动端浏览器并不是立即作出反应，而是会等上一小会儿才会出现点击的效果。在移动WEB兴起的初期，用户对300ms的延迟感觉不明显。但是，随着用户对交互体验的要求越来越高，现今，移动端300ms的点击延迟逐渐变得明显而无法忍受。 那么，移动端300ms的点击延迟是怎么来的呢？</p><h2 id="产生原因" tabindex="-1"><a class="header-anchor" href="#产生原因" aria-hidden="true">#</a> 产生原因</h2><hr><p>移动浏览器上支持的双击缩放操作，以及IOS Safari 上的双击滚动操作，是导致300ms的点击延迟主要原因。</p><h3 id="预备知识-移动端点击一个元素触发事件的顺序" tabindex="-1"><a class="header-anchor" href="#预备知识-移动端点击一个元素触发事件的顺序" aria-hidden="true">#</a> 预备知识：移动端点击一个元素触发事件的顺序</h3><p>以下是四种touch和click事件 touchstart: //手指放到屏幕上时触发 touchmove: //手指在屏幕上滑动式触发 touchend: //手指离开屏幕时触发 click：//在这个dom（或冒泡到这个dom）上手指触摸开始，且手指未曾在屏幕上移动（某些浏览器允许移动一个非常小的位移值），且在这个在这个dom上手指离开屏幕，且触摸和离开屏幕之间的间隔时间较短（某些浏览器不检测间隔时间，也会触发click）才能触发 上述事件发生顺序：在移动端，手指点击一个元素，会经过：touchstart --&gt; touchmove -&gt; touchend --&gt; click。 双击缩放：顾名思义，即用手指在屏幕上快速点击两次，移动端浏览器会将网页缩放至原始比例。 那么这和 300 毫秒延迟有什么联系呢？ 假定这么一个场景。用户在 浏览器里边点击了一个链接。由于用户可以进行双击缩放或者双击滚动的操作，当用户一次点击屏幕之后，浏览器并不能立刻判断用户是确实要打开这个链接，还是想要进行双击操作。因此，浏览器就等待 300 毫秒，以判断用户是否再次点击了屏幕。 也就是说，移动端浏览器会有一些默认的行为，比如双击缩放、双击滚动。这些行为，尤其是双击缩放，主要是为桌面网站在移动端的浏览体验设计的。而在用户对页面进行操作的时候，移动端浏览器会优先判断用户是否要触发默认的行为。</p><h2 id="解决方案" tabindex="-1"><a class="header-anchor" href="#解决方案" aria-hidden="true">#</a> 解决方案</h2><h3 id="禁用缩放" tabindex="-1"><a class="header-anchor" href="#禁用缩放" aria-hidden="true">#</a> 禁用缩放</h3><p>对于不需要缩放的页面，通过设置meta标签禁用缩放，表明这个页面是不需要缩放的，双击缩放就没有意义了。此时浏览器可以禁用默认的双击缩放行为并且去掉300ms的点击延迟。 该方法缺点在于必须通过完全禁用缩放来达到去掉点击延迟的目的，但我们初衷是想禁止默认双击缩放行为，这样就不用等待300ms来判断当前操作是否是双击。但是通常情况下我们还是希望能通过双指缩放来进行缩放操作，比如放大图片，很小的一段文字。</p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>user-scalable=no<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>initial-scale=1,maximum-scale=1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">&gt;</span></span>
### 更改默认视口宽度
移动端浏览器默认视口宽度一般比设备浏览器视窗宽度大，通常是980px,我们可以通过如下标签设置视口宽度为设备宽度。
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>width=device-width<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>因为双击缩放主要是用来改善桌面站点在移动端浏览体验的，而随着响应式设计的普及，很多站点都已经对移动端做过适配和优化了，这个时候就不需要双击缩放了，如果能够识别出一个网站是响应式的网站，那么移动端浏览器就可以自动禁掉默认的双击缩放行为并且去掉300ms的点击延迟。chrome 32+中，如果设置了上述meta标签，那浏览器就可以认为该网站已经对移动端做过了适配和优化，就无需双击缩放操作了。 这个方案相比方案一的好处在于，它没有完全禁用缩放，而只是禁用了浏览器默认的双击缩放行为，但用户仍然可以通过双指缩放操作来缩放页面。不足在于其他浏览器的支持有限。</p><h3 id="css-touch-action" tabindex="-1"><a class="header-anchor" href="#css-touch-action" aria-hidden="true">#</a> css touch-action</h3><p>指针事件（Point Event）最初由微软提出，现已进入 W3C 规范的候选推荐标准阶段 (Candidate Recommendation)。指针事件是一个新的 web 事件系列，相应的规范旨在使用一个单独的事件模型，对所有输入类型，包括鼠标 (mouse)、触摸 (touch)、触控 (stylus) 等，进行统一的处理。 例如，你可以只去监听一个元素的 pointerdown事件，无需分别监听其 touchstart和mousedown事件。其中有一个和点击延迟直接相关的实现 —— 一个名为 touch-action的新 CSS 属性。根据规范，### touch-action 属性决定 “是否触摸操作会触发用户代理的默认行为。这包括但不限于双指缩放等行为”。 从实际应用的角度来看，touch-action决定了用户在点击了目标元素之后，是否能够进行双指缩放或者双击缩放。因此，这也相当完美地解决了 300 毫秒点击延迟的问题。touch-action的默为 auto，将其置为 none 即可移除目标元素的 300 毫秒延迟。 目前而言，Internet Explorer 实现了指针事件，同时，现在已经有一些指针事件的 polyfills 可以在项目中使用了</p><h3 id="指针事件的-polyfill" tabindex="-1"><a class="header-anchor" href="#指针事件的-polyfill" aria-hidden="true">#</a> 指针事件的 polyfill</h3><p>指针事件的 polyfill 比较多，以下列出比较流行的几个。 Google 的 Polymer 微软的 HandJS @Rich-Harris 的 Points 为避免 300 毫秒点击延迟，我们主要关心这些 polyfill 是如何在非 IE 浏览器中模拟 CSS touch-action属性的，这其实是一个不小的挑战。由于浏览器会忽略不被支持的 CSS 属性，唯一能够检测开发者是否声明了 touch-action: none的方法是使用 JavaScript 去请求并解析所有的样式表。HandJS 也正是这么做的，但不管是从性能上来看还是其他一些复杂的方面，这都会遇到问题。 Polymer 则是通过判断标签上的 touch-action属性 (attribute)，而非 CSS 代码。 这对于我们开发者来说意味着什么？如果你比较感兴趣，想深入指针事件，那上述 polyfill 就非常适合应用到手头的项目中。然而，你若只想寻求一个解决 300 毫秒点击延迟的方法，上述方案可能就有点过了，因为它们要么是资源密集型的方案，要么是touch-action属性的非标准化模拟。所以，接下去我们要来看一些专门针对 300 毫秒延迟而生的解决方案</p><h3 id="zepto等库的-tap事件" tabindex="-1"><a class="header-anchor" href="#zepto等库的-tap事件" aria-hidden="true">#</a> zepto等库的 tap事件</h3><p>zepto 的touch模块中自定义了tap事件，用于代替click事件，表示一个轻击操作。touch模块实现tap的原理是绑定事件touchstart,touchmove和touchend到document上，然后通过计算touch事件触发的时间差，位置差来实现了自定义的tap,swipe等。 zepto自定义的tap操作虽然可以解决300ms点击延迟问题，但存在著名的“点透”问题。不知其最新版本有没有解决该问题。</p><h3 id="fastclick-解决300ms延迟" tabindex="-1"><a class="header-anchor" href="#fastclick-解决300ms延迟" aria-hidden="true">#</a> fastclick 解决300ms延迟</h3><p>***** FastClick 是 FT Labs 专门为解决移动端浏览器 300 毫秒点击延迟问题所开发的一个轻量级的库。 基本原理：FastClick的实现原理是在检测到touchend事件的时候，会通过DOM自定义事件立即出发模拟一个click事件，并把浏览器在300ms之后真正的click事件阻止掉。 fastClick的核心代码</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">&lt;</span>pre<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>code<span class="token operator">&gt;</span>
    <span class="token class-name">FastClick</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">onTouchEnd</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token punctuation">{</span> 
      <span class="token comment">// 一些状态监测代码 // 从这里开始， </span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">needsClick</span><span class="token punctuation">(</span>targetElement<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token comment">// 如果这不是一个需要使用原生click的元素，则屏蔽原生事件，避免触发两次click event.preventDefault(); </span>
        <span class="token comment">// 触发一次模拟的click this.sendClick(targetElement, event); </span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>code<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>pre<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>这里可以看到，FastClick在touchEnd的时候，在符合条件的情况下，主动触发了click事件，这样避免了浏览器默认的300毫秒等待判断。为了防止原生的click被触发，这里还通过event.preventDefault()屏蔽了原生的click事件。 通过sendClick模拟click事件:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>  <span class="token comment">// 业务代码</span>
  <span class="token keyword">var</span> $test <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;test&#39;</span><span class="token punctuation">)</span>
  $test<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;1 click&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// FastClick简单实现</span>
  <span class="token keyword">var</span> targetElement <span class="token operator">=</span> <span class="token keyword">null</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;touchstart&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 记录点击的元素</span>
    targetElement <span class="token operator">=</span> event<span class="token punctuation">.</span>target
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;touchend&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 阻止默认事件（屏蔽之后的click事件）</span>
    event<span class="token punctuation">.</span><span class="token function">preventDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> touch <span class="token operator">=</span> event<span class="token punctuation">.</span>changedTouches<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token comment">// 合成click事件，并添加可跟踪属性forwardedTouchEvent</span>
    <span class="token keyword">var</span> clickEvent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createEvent</span><span class="token punctuation">(</span><span class="token string">&#39;MouseEvents&#39;</span><span class="token punctuation">)</span>
    clickEvent<span class="token punctuation">.</span><span class="token function">initMouseEvent</span><span class="token punctuation">(</span><span class="token string">&#39;click&#39;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> window<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> touch<span class="token punctuation">.</span>screenX<span class="token punctuation">,</span> touch<span class="token punctuation">.</span>screenY<span class="token punctuation">,</span> touch<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span> touch<span class="token punctuation">.</span>clientY<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
    clickEvent<span class="token punctuation">.</span>forwardedTouchEvent <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// 自定义的</span>
    targetElement<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>clickEvent<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>就目前而言，FastClick 非常实际地解决 300 毫秒点击延迟的问题。唯一的缺点可能也就是该脚本的文件尺寸 (尽管它只有 10kb)。</p><h3 id="对比总结" tabindex="-1"><a class="header-anchor" href="#对比总结" aria-hidden="true">#</a> 对比总结</h3><p>禁用缩放：简单，但同时也使的网页无法缩放，不适用于未对移动端浏览做适配优化的网页。 更改默认视口宽度：简单，但需要浏览器支持。 指针事件和css touch-action:新属性，可能存在浏览器兼容问题，如仅为解决点击延迟问题儿引入一整套指针事件有点过了。 tap事件：能较好解决点击延迟，并且对其他移动端触摸事件也有较好支持，但存在点透问题，不知最新版是否解决。 fastclick:当前较好的专门解决点击延迟的库，脚本尺寸相对较大。</p><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 18811465085@163.com">jiangjingmin</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/posts/base/http/HTTPS.html" class="" aria-label="HTTPS 是如何保证安全的"><!--[--><!--]--> HTTPS 是如何保证安全的 <!--[--><!--]--></a></span><span class="next"><a href="/posts/base/http/OSI.html" class="" aria-label="OSI"><!--[--><!--]--> OSI <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.f6b3af9d.js" defer></script>
  </body>
</html>
